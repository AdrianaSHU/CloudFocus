{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-xl-12">
      
      <div class="card shadow-lg border-0 rounded-3">
        
        <div class="card-header card-header-themed text-center py-4">
          <h3 class="mb-0 fw-bold">
            <i class="bi bi-person-plus-fill me-2"></i>Create Account
          </h3>
          <p class="mb-0 opacity-75 text-light">Join CloudFocus today</p>
        </div>

        <div class="card-body p-4">
          
          {% if form.non_field_errors %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              {% for error in form.non_field_errors %}
                {{ error }}
              {% endfor %}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endif %}

          <form method="post" enctype="multipart/form-data" novalidate autocomplete="off">
            {% csrf_token %}
            
            <div class="row g-4">
              
              <div class="col-md-6">
                <div class="card h-100 border bg-light shadow-sm">
                  <div class="card-header bg-transparent border-bottom fw-bold text-muted">
                    <i class="bi bi-person-badge me-1"></i> Personal Details
                  </div>
                  <div class="card-body">
                    
                    <div class="mb-3">
                      <label for="{{ form.first_name.id_for_label }}" class="form-label fw-semibold">First Name</label>
                      {{ form.first_name }}
                      {% if form.first_name.errors %} <div class="text-danger small mt-1">{{ form.first_name.errors.0 }}</div> {% endif %}
                    </div>

                    <div class="mb-3">
                      <label for="{{ form.last_name.id_for_label }}" class="form-label fw-semibold">Last Name</label>
                      {{ form.last_name }}
                      {% if form.last_name.errors %} <div class="text-danger small mt-1">{{ form.last_name.errors.0 }}</div> {% endif %}
                    </div>

                    <div class="mb-3">
                      <label for="{{ form.email.id_for_label }}" class="form-label fw-semibold">Email</label>
                      {{ form.email }}
                      {% if form.email.help_text %} <div class="form-text text-muted small">{{ form.email.help_text }}</div> {% endif %}
                      {% if form.email.errors %} <div class="text-danger small mt-1">{{ form.email.errors.0 }}</div> {% endif %}
                    </div>

                    <div class="mb-3">
                      <label for="{{ form.profile_picture.id_for_label }}" class="form-label fw-semibold">Profile Picture</label>
                      {{ form.profile_picture }}
                      {% if form.profile_picture.errors %} <div class="text-danger small mt-1">{{ form.profile_picture.errors.0 }}</div> {% endif %}
                    </div>

                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card h-100 border bg-light shadow-sm">
                  <div class="card-header bg-transparent border-bottom fw-bold text-muted">
                    <i class="bi bi-shield-lock me-1"></i> Login Credentials
                  </div>
                  <div class="card-body">
                    
                    <div class="mb-3">
                      <label for="{{ form.username.id_for_label }}" class="form-label fw-semibold">Username</label>
                      {{ form.username }}
                      {% if form.username.help_text %} <div class="form-text text-muted" style="font-size: 0.75rem;">{{ form.username.help_text|safe }}</div> {% endif %}
                      {% if form.username.errors %} <div class="text-danger small mt-1">{{ form.username.errors.0 }}</div> {% endif %}
                    </div>

                    <div class="mb-3">
                      <label for="{{ form.password1.id_for_label }}" class="form-label fw-semibold">Password</label>
                      <div class="input-group">
                          <input type="password" name="password1" class="form-control" required id="id_password1" autocomplete="new-password">
                          <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('id_password1', this)">
                              <i class="bi bi-eye"></i>
                          </button>
                      </div>
                      {% if form.password1.help_text %} 
                        <div class="form-text text-muted" style="font-size: 0.75rem;">
                            <i class="bi bi-info-circle me-1"></i>{{ form.password1.help_text|safe }}
                        </div> 
                      {% endif %}
                      {% if form.password1.errors %} <div class="text-danger small mt-1">{{ form.password1.errors.0 }}</div> {% endif %}
                    </div>

                    <div class="mb-3">
                      <label for="{{ form.password2.id_for_label }}" class="form-label fw-semibold">Confirm Password</label>
                      <div class="input-group">
                          <input type="password" name="password2" class="form-control" required id="id_password2" autocomplete="new-password">
                          <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('id_password2', this)">
                              <i class="bi bi-eye"></i>
                          </button>
                      </div>
                      {% if form.password2.errors %} <div class="text-danger small mt-1">{{ form.password2.errors.0 }}</div> {% endif %}
                    </div>

                  </div>
                </div>
              </div>

            </div> 

            <div class="row mt-4">
              <div class="col-12">
                <div class="card border bg-white shadow-sm">
                  <div class="card-body">
                    
                    <h5 class="card-title fw-bold mb-3 text-danger text-center">
                        <i class="bi bi-shield-check"></i> Consent Declaration
                    </h5>
                    <p class="text-center text-muted small mb-4">
                        Please review the <a href="{% url 'privacy' %}" target="_blank" class="text-primary fw-bold text-decoration-underline">Privacy Policy & FAQ</a>.
                    </p>

                    <div class="mb-2 ms-3"> 
                       <div class="form-check">
                         {{ form.check_read }}
                         <label class="form-check-label small text-muted" for="{{ form.check_read.id_for_label }}">
                            {{ form.check_read.label }}
                         </label>
                         {% if form.check_read.errors %}
                           <div class="text-danger small d-block">{{ form.check_read.errors.0 }}</div>
                         {% endif %}
                       </div>
                    </div>

                    <div class="mb-4 ms-3">
                       <div class="form-check">
                         {{ form.check_consent }}
                         <label class="form-check-label small text-muted" for="{{ form.check_consent.id_for_label }}">
                            {{ form.check_consent.label }}
                         </label>
                         {% if form.check_consent.errors %}
                           <div class="text-danger small d-block">{{ form.check_consent.errors.0 }}</div>
                         {% endif %}
                       </div>
                    </div>

                    <div class="mb-4 ms-1">
                       <div style="transform: scale(0.85); transform-origin: 0 0;">
                         {{ form.captcha }}
                         {% if form.captcha.errors %}
                           <div class="text-danger mt-1 small">{{ form.captcha.errors.0 }}</div>
                         {% endif %}
                       </div>
                    </div>

                    <div class="d-grid col-md-6 mx-auto">
                      <button type="submit" class="btn btn-primary btn-lg shadow-sm">
                        Register Account
                      </button>
                    </div>

                  </div>
                </div>
              </div>
            </div>

<script>
    function togglePassword(fieldId, btn) {
        const input = document.getElementById(fieldId);
        const icon = btn.querySelector('i');
        
        if (input.type === "password") {
            input.type = "text";
            icon.classList.replace("bi-eye", "bi-eye-slash");
        } else {
            input.type = "password";
            icon.classList.replace("bi-eye-slash", "bi-eye");
        }
    }
</script>
{% endblock %}